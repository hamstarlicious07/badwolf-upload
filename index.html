<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bad Wolf — Quick Photo Upload</title>
  <script src="https://widget.cloudinary.com/v2.0/global/all.js"></script>
  <style>
    :root {
      --bg:#0c0c0f; --card:#121217; --text:#e9e9ee;
      --muted:#9da3af; --accent:#7357ff; --accent-2:#5a44d6;
    }
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      display:flex; align-items:flex-start; justify-content:center;
    }
    .wrap{width:100%; max-width:720px; padding:24px}
    h1{margin:0 0 10px; font-size:42px; letter-spacing:.3px}
    p{margin:0 0 18px; color:var(--muted); line-height:1.5}
    .btn{
      display:inline-flex; align-items:center; gap:.6rem;
      padding:16px 18px; border-radius:14px; border:0;
      background:var(--accent); color:white; font-weight:700;
      box-shadow:0 10px 30px rgba(115,87,255,.3);
    }
    .btn:active{transform:translateY(1px)}
    .hint{margin-top:10px; color:var(--muted); font-size:13px}
    /* Toast */
    #toast{
      position:fixed; left:50%; bottom:18px; transform:translateX(-50%);
      background:#171923; color:#f8fafc; padding:12px 14px;
      border-radius:12px; box-shadow:0 10px 30px rgba(0,0,0,.35);
      opacity:0; pointer-events:none; transition:opacity .25s, transform .25s;
      font-weight:600; letter-spacing:.2px;
    }
    #toast.show{opacity:1; transform:translateX(-50%) translateY(-6px)}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Take a photo</h1>
    <p>Shoot → we shrink it → upload → URL auto-copied.</p>

    <button id="open" class="btn">📸 Open Camera</button>
    <div id="toast" role="status" aria-live="polite"></div>
    <div class="hint" id="hint" style="display:none;">
      If the camera didn’t open automatically, tap <b>Open Camera</b>.
    </div>
  </div>

  <script>
    // 🔧 set your Cloudinary project values
    const cloudName    = "dbvq3eily";           // ← yours
    const uploadPreset = "badwolf_unsigned";    // ← yours

    // Small toast helper
    const toastEl = document.getElementById('toast');
    let toastTimer;
    function toast(msg){
      clearTimeout(toastTimer);
      toastEl.textContent = msg;
      toastEl.classList.add('show');
      toastTimer = setTimeout(()=>toastEl.classList.remove('show'), 1600);
    }

    // Create the widget
    const widget = cloudinary.createUploadWidget({
      cloudName,
      uploadPreset,
      sources: ['camera','local'],
      multiple: false,
      folder: 'badwolf/transactions',
      clientAllowedFormats: ['jpg','jpeg','png','webp'],
      maxImageFileSize: 6_000_000,   // 6 MB cap (adjust as you like)
      cropping: false
    }, async (error, result) => {
      if (error) {
        toast('Upload failed');
        return;
      }
      if (result && result.event === "success") {
        const url = result.info.secure_url; // raw upload URL
        // Auto-copy to clipboard
        try {
          await navigator.clipboard.writeText(url);
          toast('✅ URL copied to clipboard');
        } catch {
          toast('⚠️ Copy failed — long press to copy');
        }
      }
    });

    // Open on button tap
    document.getElementById('open').addEventListener('click', () => widget.open());

    // Try to auto-open on page load (iOS may block without a user gesture)
    window.addEventListener('load', () => {
      // Give the widget a moment to initialize
      setTimeout(() => {
        try {
          widget.open();
          // If the browser blocks it, the button remains visible.
          // Show a hint after a short delay so users know what to do.
          setTimeout(()=> document.getElementById('hint').style.display = 'block', 900);
        } catch {
          document.getElementById('hint').style.display = 'block';
        }
      }, 150);
    });
  </script>
</body>
</html>
